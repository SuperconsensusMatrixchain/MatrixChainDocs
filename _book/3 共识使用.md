### 3.1 整体介绍

xuperchain目前提供的共识算法包括:

#### 3.1.1 Single

   单节点矿工机制。在集群中仅有一个固定角色的矿工，该矿工负责生产区块，其余节点从其同步账本。

#### 3.1.2 POW

​    类似于Bitcoin种的PoW机制。在集群中每个节点都以矿工身份进行挖矿，并且从其他节点同步区块。

#### 3.1.3 TDPOS和XPOS

​	XuperChain自研的类DPoS算法。节点可向系统抵押治理Token以投票给自身支持的候选人节点，系统按照治理Token抵押总数排序，选取指定数量的节点作为候选人节点，候选人组按照时间片进行矿工轮转。XPoS在TDPoS基础上，增加了底层Chained-BFT组件，确保系统在指定区块高度下账本不可回滚，保证业务数据落盘。

#### 3.1.4 POA和XPOA

XuperChain自研的类PoA算法，适合联盟链场景，节点可使用专有合约进行权益转移，按照业务要求对联盟链中共识节点进行说明，候选人节点根据专有合约进行变更，变更需要联盟中指定节点进行签名。XPoA在PoA基础上，增加了底层Chained-BFT组件，确保系统在指定区块高度下账本不可回滚，保证业务数据落盘。

### 3.2 TDPOS 使用

#### 3.2.1 共识状态查看

1 共识状态查询

```
./bin/xchain-cli consensus status
```



#### 3.2.2 创世块配置介绍

Tdpos类共识的创世块示例在上述 `/data/genesis/tdpos.json` 中，下面简要介绍:

```
    "genesis_consensus":{
        "name": "tdpos",   // 共识名称，TDPoS和XPoS的统称
        "config": {
                "timestamp": "1559021720000000000",   // 开始时间，可忽略
                "proposer_num": "2",   // 【重要】候选人集合总人数，配置后只能通过【共识升级修改】
                "period": "3000",   // 【重要】每个块生产固定时间，单位为毫秒，示例所示为3s一个块
                "alternate_interval": "3000",   // 同一轮矿工切换间隙时间
                "term_interval": "6000",    // term切换间隙时间
                "block_num": "20",  // 【重要】每个候选人在一轮轮数中需要出块的数目
                "vote_unit_price": "1", // 计票单位
                "init_proposer": {
                    "1": ["TeyyPLpp9L7QAcxHangtcHTu7HUZ6iydY", "SmJG3rH2ZzYQ9ojxhbRCPwFiE9y6pD1Co"] // 【重要】数组中记录了全部初始候选人节点的address
                },
                // , "bft_config":{}  // 可选项，即加载chained-bft组件，加载后共识实际上为XPoS。
        }
}
```



#### 3.2.3 TDPOS投票流程

##### 1 整体流程

TDPoS类命令行操作，仅限变更候选人集合地址信息，主要需要以下流程：

- 某节点发起 **候选人提名nominate** ，发起需要是一个ACL账户，该ACL账户需包含被提名人的地址，走多签流程完成候选人池的修改。完成之后，指定节点加入候选人池。

- 节点对候选人池进行 **投票vote** ，对候选人池中显示的节点地址投票。

- **计票** ，在每轮term开始时，会检查候选人投票池的 TopK名候选人(即创世块 `proposer_num` 字段)并指定为该轮候选人集合。

  

  注意：若投票的目标候选人池数量小于创世块 `proposer_num` 字段，投票并不会生效。

##### 2 治理代币生成

下述提案投票时必须确保ACL或者节点账户拥有Token，即先向账户发起transfer，否则会报失败错误

##### 3 候选人流程

* 提名



* 撤销提名



* 投票



* 撤销投票

### 3.3 POA类使用

